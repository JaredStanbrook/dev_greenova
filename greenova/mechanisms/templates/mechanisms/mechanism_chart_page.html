{% extends "base.html" %}

{% load static %}

{% block title %}
Mechanism Chart
{% endblock title %}

{% block extra_head %}
  <script src="{% static 'js/vendor/chart.umd.js' %}"></script>
  <style>
      .chart-container {
          background: white;
          border-radius: 8px;
          padding: 2rem;
          margin: 2rem 0;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          min-height: 400px;
      }

      .chart-wrapper {
          position: relative;
          height: 400px;
      }

      #loading {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
      }
  </style>
{% endblock extra_head %}

{% block content %}
  <article>
    <header>
      <h1>
Mechanism Analysis
      </h1>
      <nav>
        <a href="{% url 'dashboard:home' %}" class="button outline">‚Üê Back to Dashboard</a>
      </nav>
    </header>

    <div class="chart-container">
      <figure class="chart-wrapper">
        <canvas id="mechanismChart"></canvas>
        <div id="loading" hidden>
Loading chart data...
        </div>
      </figure>
    </div>
  </article>

  <script>
      document.addEventListener('DOMContentLoaded', function() {
          const canvas = document.getElementById('mechanismChart');
          const loading = document.getElementById('loading');

          loading.hidden = false;

          fetch('{{ chart_endpoint|safe }}')
              .then(response => {
                  if (!response.ok) {
                      throw new Error('Network response was not ok');
                  }
                  return response.json();
              })
              .then(config => {
                  loading.hidden = true;
                  new Chart(canvas, {
                      ...config,
                      options: {
                          ...config.options,
                          responsive: true,
                          maintainAspectRatio: false,
                          plugins: {
                              legend: {
                                  position: 'right',
                                  labels: {
                                      padding: 20,
                                      usePointStyle: true
                                  }
                              }
                          }
                      }
                  });
              })
              .catch(error => {
                  console.error('Error loading chart:', error);
                  loading.hidden = true;
                  canvas.parentElement.innerHTML = '<p class="error">Failed to load chart data</p>';
              });
      });
  </script>
{% endblock content %}
