{% if error %}
<article role="alert">
    <p>{{ error }}</p>
</article>
{% elif project %}
<article id="project-content">
    <header>
        <hgroup>
            <h2>{{ project.name }}</h2>
            {% if project.description %}
            <p>{{ project.description }}</p>
            {% endif %}
        </hgroup>
    </header>

    <!-- Project Charts -->
    <section aria-labelledby="charts-heading">
        <header>
            <h3 id="charts-heading">Environmental Mechanisms</h3>
            <nav>
                <a href="{% url 'analytics:aspect_analysis' project.id %}"
                   role="button"
                   class="outline">
                    Full Aspect Analysis
                </a>
            </nav>
        </header>
        <div class="grid">
            {% for mechanism in mechanisms %}
            <figure role="region"
                    aria-label="{{ mechanism.name }} Distribution"
                    class="chart-container">
                <header>
                    <h4>{{ mechanism.name }}</h4>
                </header>
                <canvas id="chart-{{ forloop.counter }}"
                        data-mechanism="{{ mechanism.name }}"
                        data-chart='{
                            "labels": ["Not Started", "In Progress", "Completed"],
                            "datasets": [{
                                "data": [
                                    {% for status in mechanism.status_counts %}
                                        {{ status.count }}{% if not forloop.last %},{% endif %}
                                    {% endfor %}
                                ],
                                "backgroundColor": [
                                    "var(--error)",
                                    "var(--primary)",
                                    "var(--success)"
                                ]
                            }]
                        }'></canvas>
                <figcaption>
                    <details>
                        <summary>Status Distribution</summary>
                        <dl>
                            {% for status in mechanism.status_counts %}
                            <dt>{{ status.status|title }}</dt>
                            <dd>{{ status.count }}</dd>
                            {% endfor %}
                        </dl>
                    </details>
                </figcaption>
            </figure>
            {% endfor %}
        </div>
    </section>

    <!-- Project Obligations -->
    <section id="obligations-section">
        {% include "obligations/tables/obligation_list.html" with obligations=obligations %}
    </section>
</article>
{% else %}
<article role="alert">
    <p>Please select a project to view details.</p>
</article>
{% endif %}