{% load project_tags %}

<article>
  <header>
    <h2>{{ project.name }}</h2>
    {% if project.description %}
      <p>{{ project.description }}</p>
    {% endif %}
  </header>

  {% project_stats_chart project %}

  <section aria-labelledby="mechanism-heading">
    <h3 id="mechanism-heading">Environmental Mechanisms</h3>
    <figure>
      <canvas id="mechanismsChart" 
              data-chart="bar"
              data-labels="{{ mechanisms|map:'primary_environmental_mechanism'|join:',' }}"
              data-values="{{ mechanisms|map:'count'|join:',' }}">
      </canvas>
      <figcaption>Distribution of Environmental Mechanisms</figcaption>
    </figure>
  </section>

  {% if obligations %}
    <section aria-labelledby="obligations-heading">
      <h3 id="obligations-heading">Recent Obligations</h3>
      {% obligation_table obligations %}
    </section>
  {% endif %}

  {% if user_role in 'owner,manager'|split:',' %}
    <footer>
      <nav>
        <a href="{% url 'obligations:create' project.id %}" role="button">Add Obligation</a>
        <a href="{% url 'projects:edit' project.id %}" role="button" class="outline">Edit Project</a>
      </nav>
    </footer>
  {% endif %}
</article>