{% load project_tags %}
<div id="project-selector-container">
  <form id="project-form"
        hx-trigger="change from:#project-select"
        hx-swap="multi:#chart-container:innerHTML,#obligations-container:innerHTML">
    <label for="project-select">Please pick your project from the list below:</label>
    <br />
    <select id="project-select"
            name="project"
            aria-controls="data-containers">
      <option value="">Select a project...</option>
      {% for project in projects %}
        <option value="{{ project.id }}"
                {% if project.id == selected_project_id %}selected{% endif %}>
          {{ project.name }}
        </option>
      {% endfor %}
    </select>
  </form>

  <div id="data-containers">
    <!-- Charts Container -->
    <div id="chart-container"
         hx-get="{% url 'mechanisms:mechanism_charts' %}"
         hx-trigger="change from:#project-select"
         hx-include="#project-form"
         hx-target="this"
         _="on htmx:beforeRequest
            set this.innerHTML to '<div class=\'notice\' role=\'status\' aria-busy=\'true\'>Loading...</div>'">
      <div class="notice" role="status">
        <p>Select a project to view mechanism charts.</p>
      </div>
    </div>

    <!-- Obligations Container -->
    <div id="obligations-container"
         hx-get="{% url 'obligations:summary' %}"
         hx-trigger="change from:#project-select"
         hx-include="#project-form"
         hx-target="this"
         _="on htmx:beforeRequest
            set this.innerHTML to '<div class=\'notice\' role=\'status\' aria-busy=\'true\'>Loading...</div>'">
      <div class="notice" role="status">
        <p>Select a project to view obligations.</p>
      </div>
    </div>
  </div>
</div>

<!-- Error Handling with Hyperscript -->
<script type="text/hyperscript">
  on htmx:responseError from #chart-container, #obligations-container
    set innerHTML of event.target to "<div class='notice error' role='alert'><p>Error loading data. Please try again.</p></div>"
</script>

<!-- Initial load trigger if a project is selected
<script type="text/hyperscript">
  on load
    if #project-select.value is not ""
      trigger #chart-container change
      trigger #obligations-container change
</script> -->
