{% extends 'analytics/layouts/analytics_base.html' %}

{% block page_title %}Mechanism Performance{% endblock %}
{% block page_subtitle %}Environmental Mechanism Analysis{% endblock %}

{% block extra_styles %}
<style>
  .mechanism-grid {
    gap: 1rem;
  }

  .chart-container {
    min-height: 300px;
  }
</style>
{% endblock %}

{% block page_actions %}
<div class="actions">
  <button type="button" hx-get="{% url 'analytics:export_mechanism_data' %}"
          class="outline">Export Data</button>
  <button type="button" hx-get="{% url 'analytics:refresh_mechanism_data' %}"
          class="outline">Refresh</button>
</div>
{% endblock %}

{% block content %}
<section aria-labelledby="mechanism-stats">
  <h2 id="mechanism-stats">Mechanism Statistics</h2>

  <div class="grid">
    {% for mechanism in mechanisms %}
    <article>
      <header>
        <h3>{{ mechanism.name }}</h3>
      </header>
      {% include "analytics/components/charts/mechanism_status.html" with mechanism=mechanism %}
      <footer>
        <details>
          <summary>View Details</summary>
          <dl>
            <dt>Total Obligations</dt>
            <dd>{{ mechanism.total_obligations }}</dd>
            <dt>Completion Rate</dt>
            <dd>{{ mechanism.completion_rate }}%</dd>
          </dl>
        </details>
      </footer>
    </article>
    {% endfor %}
  </div>
</section>

<section aria-labelledby="trend-analysis">
  <h2 id="trend-analysis">Trend Analysis</h2>
  {% include "analytics/components/charts/trend_chart.html" %}
</section>

<dialog id="loading-dialog" aria-labelledby="loading-title">
  <article>
    <header>
      <h3 id="loading-title">{{ loading_title|default:"Loading..." }}</h3>
    </header>

    <div role="status" aria-busy="true">
      <progress></progress>
      <p>{{ loading_message }}</p>
    </div>
  </article>
</dialog>
{% endblock %}

{% block sidebar %}
<nav aria-label="Mechanism filters">
  <h3>Filters</h3>
  <!-- ...filter controls... -->
</nav>
{% endblock %}