{% extends 'analytics/layouts/analytics_base.html' %}
{% load analytics_tags common_tags %}

<section>
  {% for mechanism in mechanisms %}
  {% mechanism_chart_data mechanism as chart_data %}
  <figure role="region"
          aria-label="{{ mechanism.name }} Status Distribution"
          class="chart-container">
    <header>
      <h3 id="chart-title-{{ mechanism.id }}">{{ mechanism.name }}</h3>
    </header>

    {% if chart_data %}
    <canvas id="status-chart-{{ mechanism.id }}"
            data-chart="{{ chart_data|json_script }}"
            aria-labelledby="chart-title-{{ mechanism.id }}"
            height="200">
    </canvas>
    {% else %}
    <p>{{ chart_error_message }}</p>
    {% endif %}

    <div class="htmx-indicator" role="status" aria-busy="true">
      Loading {{ mechanism.name }} distribution data...
    </div>

    <figcaption>
      <details>
        <summary>Distribution Details</summary>
        <dl>
          {% for status, count in chart_data.items %}
          <dt>{{ status|title }}</dt>
          <dd>{{ count }}</dd>
          {% endfor %}
        </dl>
      </details>
    </figcaption>
  </figure>
  {% endfor %}
  {% chart_container 
   chart_id="mechanism-chart"
   title=mechanism.name
   data=chart_data
   height="300px" %}
</section>
{% endblock %}