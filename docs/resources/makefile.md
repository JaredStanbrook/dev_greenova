# Makefile Guide for Greenova Project

## Introduction to Make

Make is a build automation tool that automatically builds executable programs
and libraries from source code by reading files called Makefiles. Make was
originally created by Stuart Feldman in 1976 at Bell Labs and remains one of
the most widely used build tools in software development.

Make's primary purpose is to determine which pieces of a large program need to
be recompiled and issue the commands to recompile them when necessary. However,
in modern development, Make has expanded to automate various tasks beyond
compilation.

## Makefile Fundamentals

### Basic Structure

A Makefile consists of a set of rules with the following format:

```makefile
target: prerequisites
    recipe
```

Where:

- **target**: The file to be created or action to be executed
- **prerequisites**: Files that the target depends on
- **recipe**: Commands executed to create the target or perform an action (must
  be indented with a tab)

### Example of a Simple Rule

```makefile
hello.o: hello.c
    gcc -c hello.c -o hello.o
```

### Variables

Variables in Makefiles help maintain consistency and make the file more
readable:

```makefile
CC = gcc
CFLAGS = -Wall -g

hello.o: hello.c
    $(CC) $(CFLAGS) -c hello.c -o hello.o
```

### Phony Targets

Phony targets are used for actions rather than file creation:

```makefile
.PHONY: clean
clean:
    rm -f *.o
```

## Makefiles in the Python Ecosystem

For Python projects like Greenova, Makefiles serve several purposes:

1. Managing virtual environments
2. Installing dependencies
3. Running tests
4. Code formatting and linting
5. Building documentation
6. Deployment tasks

### Example Python Project Makefile Structure

```makefile
VENV = .venv
PYTHON = $(VENV)/bin/python
PIP = $(VENV)/bin/pip
REQUIREMENTS = requirements.txt

.PHONY: venv install test clean

venv:
    python3 -m venv $(VENV)

install: venv
    $(PIP) install --upgrade pip
    $(PIP) install -r $(REQUIREMENTS)

test: install
    $(PYTHON) -m pytest

clean:
    rm -rf $(VENV) __pycache__ .pytest_cache
```

## Makefile.am and Makefile.in

These are part of the GNU Autotools build system:

- **Makefile.am**: A simplified, high-level Makefile written by developers
- **Makefile.in**: Generated by automake from Makefile.am, serving as a
  template
- **Makefile**: The final file created by configure script from Makefile.in

### When to Use Autotools

Autotools (including Makefile.am and Makefile.in) are most useful for:

1. Cross-platform C/C++ projects
2. Projects requiring complex configuration detection
3. Applications that need to work across diverse Unix-like environments

For Python projects like Greenova, standard Makefiles are usually sufficient.

## Updated Greenova Project Makefile

The Greenova project uses a Makefile to streamline development workflows. Below
is an updated guide based on the current Makefile and best practices.

### Key Variables

```makefile
# Define the virtual environment path
VENV = .venv

# Define the Python and pip paths
PYTHON = $(VENV)/bin/python3
PIP = $(VENV)/bin/pip

# Define requirements and constraints files
REQUIREMENTS = requirements/dev.txt
CONSTRAINTS = requirements/constraints.txt
```

### Common Commands

| Command                 | Purpose                                              |
| ----------------------- | ---------------------------------------------------- |
| `make venv`             | Creates a Python virtual environment                 |
| `make install`          | Installs project dependencies                        |
| `make freeze`           | Freezes installed dependencies into requirements.txt |
| `make app name`         | Creates a new Django app                             |
| `make run`              | Starts the Django server with pre-built Tailwind CSS |
| `make run-django`       | Starts only the Django server                        |
| `make run-tailwind`     | Starts the Tailwind CSS build process                |
| `make tailwind-build`   | Builds Tailwind CSS                                  |
| `make tailwind-install` | Installs Tailwind CSS dependencies                   |
| `make update`           | Updates data from a CSV file                         |
| `make clean`            | Removes the virtual environment and temporary files  |
| `make lint-templates`   | Lints Django template files                          |
| `make format-templates` | Formats Django template files                        |
| `make help`             | Lists all available commands                         |

### Example Usage

```bash
# Initial setup
make venv
make install

# Development workflow
make run

# Before committing code
make lint-templates
make format-templates
```

### Targets

#### Environment Setup

- **venv**: Creates a Python virtual environment.

  ```bash
  make venv
  ```

  This command sets up a virtual environment in the `.venv` directory.

- **install**: Installs project dependencies.

  ```bash
  make install
  ```

  This command uses `pip` to install dependencies listed in
  `requirements/dev.txt` with constraints from `requirements/constraints.txt`.

#### Dependency Management

- **freeze**: Freezes installed dependencies into `requirements.txt`.

  ```bash
  make freeze
  ```

#### Application Management

- **app**: Creates a new Django app.

  ```bash
  make app name
  ```

- **run**: Starts the Django development server with pre-built Tailwind CSS.

  ```bash
  make run
  ```

- **run-django**: Starts only the Django server using Gunicorn.

  ```bash
  make run-django
  ```

- **run-tailwind**: Starts the Tailwind CSS build process.

  ```bash
  make run-tailwind
  ```

#### Tailwind CSS

- **tailwind-build**: Builds Tailwind CSS.

  ```bash
  make tailwind-build
  ```

- **tailwind-install**: Installs Tailwind CSS dependencies.

  ```bash
  make tailwind-install
  ```

#### Cleaning

- **clean**: Removes the virtual environment and temporary files.

  ```bash
  make clean
  ```

#### Template Management

- **lint-templates**: Lints Django template files.

  ```bash
  make lint-templates
  ```

- **format-templates**: Formats Django template files.

  ```bash
  make format-templates
  ```

#### Help

- **help**: Lists all available commands.

  ```bash
  make help
  ```

### Notes

- Ensure the `.env` file is present before running commands that require
  environment variables.
- Use `make help` to view all available commands and their descriptions.

### Best Practices

1. **Use Variables**: Define paths, commands, and options as variables at the
   top of the file.
2. **Declare Phony Targets**: Mark targets that don't represent files with
   `.PHONY`.
3. **Document Your Makefile**: Add comments explaining complex recipes or
   variables.
4. **Keep It Modular**: Split complex Makefiles using include directives if
   necessary.
5. **Use Source Control**: Keep your Makefile under version control to track
   changes.

## Debugging Makefiles

When Makefiles don't behave as expected:

- Use `make -n` to print commands without executing them
- Use `make -d` for detailed debug information
- Add `@echo` statements in recipes to print variable values
- Use `$(info $(VARIABLE))` to debug variables during parsing

## References

[1]: https://www.gnu.org/software/make/manual/ 'GNU Make Manual, Free Software Foundation, 2020'
[2]: https://en.wikipedia.org/wiki/Make_(software) 'Make (software), Wikipedia'
[3]: https://nostarch.com/gnu-make-book 'The GNU Make Book, No Starch Press, 2015'
[4]: https://earthly.dev/blog/python-makefile/ 'Makefiles for Python Projects, Earthly Technologies, 2022'
[5]: https://stackabuse.com/how-to-write-a-makefile-automating-python-setup-compilation-and-testing/ 'How to write a Makefile, Stack Abuse, 2021'
[6]: https://www.evan-soil.io/blog/ode-to-gnu-make/ 'Ode to GNU Make, Evan Soil, 2022'

1. [GNU Make Manual][1]
2. [Make (software)][2]
3. [The GNU Make Book][3]
4. [Makefiles for Python Projects][4]
5. [How to write a Makefile][5]
6. [Ode to GNU Make][6]
